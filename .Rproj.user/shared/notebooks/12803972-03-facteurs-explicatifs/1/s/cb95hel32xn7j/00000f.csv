"0","library(tidyverse)"
"0","if (!requireNamespace(""afex"", quietly = TRUE)) install.packages(""afex"", repos = ""https://cloud.r-project.org"", quiet = TRUE)"
"0","library(afex)"
"0","library(emmeans)"
"0","library(car)"
"0","library(knitr)"
"0",""
"0","# Chemins possibles (projet = répertoire de travail ou parent)"
"0","fichiers_xlsx <- c(""donnees/donnees.xlsx"", ""../donnees/donnees.xlsx"")"
"0","fichiers_csv  <- c(""donnees.csv"", ""../donnees.csv"")"
"0",""
"0","fichier_xlsx <- fichiers_xlsx[file.exists(fichiers_xlsx)][1]"
"0","fichier_csv  <- fichiers_csv[file.exists(fichiers_csv)][1]"
"0",""
"0","d <- NULL"
"0","if (!is.na(fichier_xlsx)) {"
"0","  tryCatch({"
"0","    if (!requireNamespace(""readxl"", quietly = TRUE)) install.packages(""readxl"", repos = ""https://cloud.r-project.org"", quiet = TRUE)"
"0","    library(readxl)"
"0","    d <- read_excel(fichier_xlsx)"
"0","    noms <- names(d)"
"0","    noms <- tolower(trimws(noms))"
"0","    noms <- gsub(""\\s+"", ""_"", noms)"
"0","    noms <- chartr(""éèêëàâäùûüôöîïç"", ""eeeeaaaauuuooiic"", noms)"
"0","    names(d) <- noms"
"0","    periodes_noms <- grep(""^t[1-4]$"", names(d), value = TRUE)"
"0","    if (length(periodes_noms) >= 2L) {"
"0","      d <- d %>%"
"0","        mutate(id = paste0(""S"", row_number())) %>%"
"0","        pivot_longer(all_of(periodes_noms), names_to = ""periode"", values_to = ""taille"") %>%"
"0","        mutate(periode = factor(toupper(periode), levels = paste0(""T"", 1:4)))"
"0","    }"
"0","    if (any(names(d) == ""variété"")) names(d)[names(d) == ""variété""] <- ""variete"""
"0","    # Format long avec identifiant sujet LOCAL (ex. colonne P qui repart de 1 par groupe×variété) -> id global"
"0","    if (!""id"" %in% names(d)) {"
"0","      noms_id_local <- c(""p"", ""id"", ""sujet"", ""subject"", ""no"", ""numero"", ""plant"", ""individu"")"
"0","      candidat <- intersect(noms_id_local, names(d))[1]"
"0","      if (!is.na(candidat)) d$id <- paste0(d$groupe, ""_"", d$variete, ""_"", d[[candidat]])"
"0","    }"
"0","  }, error = function(e) d <<- NULL)"
"0","}"
"0","if (is.null(d) && !is.na(fichier_csv)) {"
"0","  tryCatch({"
"0","    d <- read_csv(fichier_csv, show_col_types = FALSE)"
"0","  }, error = function(e) d <<- NULL)"
"0","}"
"0","if (is.null(d)) {"
"0","  set.seed(42)"
"0","  n_par_combinaison <- 8L"
"0","  d <- expand_grid("
"0","    groupe = c(""Ma"", ""Ca"", ""An""),"
"0","    variete = c(""Var1"", ""Var2""),"
"0","    periode = paste0(""T"", 1:4)"
"0","  ) %>%"
"0","    slice(rep(1:n(), each = n_par_combinaison)) %>%"
"0","    mutate("
"0","      id = paste0(""P"", rep(1:(n_par_combinaison * 6), each = 4)),"
"0","      taille = round(10 + as.numeric(factor(periode)) * 2 + rnorm(n(), 0, 1.5), 2)"
"0","    )"
"0","}"
"0",""
"0","# Création de l'id si absent : chaque id doit être dans une seule condition (groupe × variete)"
"0","if (!""id"" %in% names(d)) {"
"0","  n_periodes <- length(unique(d$periode))"
"0","  d <- d %>%"
"0","    arrange(groupe, variete, periode) %>%"
"0","    group_by(groupe, variete) %>%"
"0","    mutate("
"0","      within_subj = (row_number() - 1) %/% n_periodes + 1,"
"0","      id = paste0(groupe, ""_"", variete, ""_"", within_subj)"
"0","    ) %>%"
"0","    ungroup()"
"0","}"
"0",""
"0","# Période : accepter 1,2,3,4 (numérique) ou T1,T2,T3,T4"
"0","d <- d %>%"
"0","  mutate("
"0","    periode = factor("
"0","      if_else(grepl(""^T"", as.character(periode)), as.character(periode), paste0(""T"", as.character(periode))),"
"0","      levels = paste0(""T"", 1:4)"
"0","    ),"
"0","    groupe = factor(groupe, levels = c(""Ma"", ""Ca"", ""An"")),"
"0","    variete = factor(variete),"
"0","    id = factor(id)"
"0","  )"
"0",""
"0","# ANOVA à mesures répétées (deux facteurs inter-sujets + un facteur intra-sujet)"
"0","modele <- aov_ez("
"0","  id = ""id"","
"0","  dv = ""taille"","
"0","  data = d,"
"0","  between = c(""groupe"", ""variete""),"
"0","  within = ""periode"","
"0","  type = 3,"
"0","  anova_table = list(correction = ""GG"", es = ""pes"")"
"0",")"
