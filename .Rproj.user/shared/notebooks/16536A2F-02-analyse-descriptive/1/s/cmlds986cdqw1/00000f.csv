"0","library(tidyverse)"
"0","library(knitr)"
"0",""
"0","# Chemins possibles (projet = répertoire de travail ou parent)"
"0","fichiers_xlsx <- c(""donnees/donnees.xlsx"", ""../donnees/donnees.xlsx"")"
"0","fichiers_csv  <- c(""donnees.csv"", ""../donnees.csv"")"
"0",""
"0","fichier_xlsx <- fichiers_xlsx[file.exists(fichiers_xlsx)][1]"
"0","fichier_csv  <- fichiers_csv[file.exists(fichiers_csv)][1]"
"0",""
"0","d <- NULL"
"0","if (!is.na(fichier_xlsx)) {"
"0","  tryCatch({"
"0","    if (!requireNamespace(""readxl"", quietly = TRUE)) install.packages(""readxl"", repos = ""https://cloud.r-project.org"", quiet = TRUE)"
"0","    library(readxl)"
"0","    d <- read_excel(fichier_xlsx)"
"0","    noms <- names(d)"
"0","    noms <- tolower(trimws(noms))"
"0","    noms <- gsub(""\\s+"", ""_"", noms)"
"0","    noms <- chartr(""éèêëàâäùûüôöîïç"", ""eeeeaaaauuuooiic"", noms)"
"0","    names(d) <- noms"
"0","    periodes_noms <- grep(""^t[1-4]$"", names(d), value = TRUE)"
"0","    if (length(periodes_noms) >= 2L) {"
"0","      d <- d %>%"
"0","        mutate(id = paste0(""S"", row_number())) %>%"
"0","        pivot_longer(all_of(periodes_noms), names_to = ""periode"", values_to = ""taille"") %>%"
"0","        mutate(periode = factor(toupper(periode), levels = paste0(""T"", 1:4)))"
"0","    }"
"0","    if (any(names(d) == ""variété"")) names(d)[names(d) == ""variété""] <- ""variete"""
"0","  }, error = function(e) d <<- NULL)"
"0","}"
"0","if (is.null(d) && !is.na(fichier_csv)) {"
"0","  tryCatch({"
"0","    d <- read_csv(fichier_csv, show_col_types = FALSE)"
"0","  }, error = function(e) d <<- NULL)"
"0","}"
"0","if (is.null(d)) {"
"0","  set.seed(42)"
"0","  n_par_combinaison <- 8L"
"0","  d <- expand_grid("
"0","    groupe = c(""Ma"", ""Ca"", ""An""),"
"0","    variete = c(""Var1"", ""Var2""),"
"0","    periode = paste0(""T"", 1:4)"
"0","  ) %>%"
"0","    slice(rep(1:n(), each = n_par_combinaison)) %>%"
"0","    mutate("
"0","      id = paste0(""P"", rep(1:(n_par_combinaison * 6), each = 4)),"
"0","      taille = round(10 + as.numeric(factor(periode)) * 2 + rnorm(n(), 0, 1.5), 2)"
"0","    )"
"0","}"
"0",""
"0","if (!""id"" %in% names(d)) {"
"0","  n_periodes <- length(unique(d$periode))"
"0","  n_sujets   <- nrow(d) %/% n_periodes"
"0","  if (n_sujets * n_periodes == nrow(d)) {"
"0","    d$id <- paste0(""S"", rep(1:n_sujets, each = n_periodes))"
"0","  } else {"
"0","    d$id <- paste0(""S"", rep(1:ceiling(nrow(d) / n_periodes), each = n_periodes)[1:nrow(d)])"
"0","  }"
"0","}"
"0",""
"0","d <- d %>%"
"0","  mutate("
"0","    groupe = factor(groupe, levels = c(""Ma"", ""Ca"", ""An"")),"
"0","    variete = factor(variete),"
"0","    periode = factor(periode, levels = paste0(""T"", 1:4)),"
"0","    id = factor(id)"
"0","  )"
"0",""
"0","head(d) %>% kable(caption = ""Aperçu du jeu de données (format long)"")"
