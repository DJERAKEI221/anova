"0","# --- Import et mise en forme (structure : groupe, variete, periode, taille, id) ---"
"0","if (!requireNamespace(""readxl"", quietly = TRUE)) install.packages(""readxl"", repos = ""https://cloud.r-project.org"", quiet = TRUE)"
"0","library(readxl)"
"0","d <- read_excel(""donnees/donnees.xlsx"")"
"0","# Noms normalisés (minuscules, _, sans accents)"
"0","noms <- tolower(trimws(names(d)))"
"0","noms <- gsub(""\\s+"", ""_"", chartr(""éèêëàâäùûüôöîïç"", ""eeeeaaaauuuooiic"", noms))"
"0","names(d) <- noms"
"0","if (any(names(d) == ""variété"")) names(d)[names(d) == ""variété""] <- ""variete"""
"0",""
"0","# Format large (T1–T4) → long"
"0","periodes_noms <- grep(""^t[1-4]$"", names(d), value = TRUE)"
"0","if (length(periodes_noms) >= 2L) {"
"0","  id_col <- intersect(c(""p"", ""id"", ""sujet"", ""no"", ""numero""), names(d))[1]"
"0","  if (is.na(id_col)) d$id <- paste0(d$groupe, ""_"", d$variete, ""_"", row_number())"
"0","  else d$id <- paste0(d$groupe, ""_"", d$variete, ""_"", d[[id_col]])"
"0","  d <- d %>%"
"0","    pivot_longer(all_of(periodes_noms), names_to = ""periode"", values_to = ""taille"") %>%"
"0","    mutate(periode = factor(toupper(periode), levels = paste0(""T"", 1:4))) %>%"
"0","    filter(!is.na(taille))"
"0","} else {"
"0","  # Déjà en long : id si absent"
"0","  if (!""id"" %in% names(d)) {"
"0","    d <- d %>%"
"0","      arrange(groupe, variete, periode) %>%"
"0","      group_by(groupe, variete, periode) %>%"
"0","      mutate(within_subj = row_number()) %>%"
"0","      ungroup() %>%"
"0","      mutate(id = paste0(groupe, ""_"", variete, ""_"", within_subj))"
"0","  }"
"0","}"
"0",""
"0","# Taille numérique ; facteurs"
"0","d$taille <- as.numeric(as.character(d$taille))"
"0","d <- d %>%"
"0","  mutate("
"0","    periode = factor(as.character(periode), levels = paste0(""T"", 1:4)),"
"0","    groupe = factor(groupe, levels = c(""Ma"", ""Ca"", ""An"")),"
"0","    variete = factor(variete),"
"0","    id = factor(id)"
"0","  )"
